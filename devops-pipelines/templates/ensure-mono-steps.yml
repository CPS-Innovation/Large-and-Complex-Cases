steps:
  - script: |
      if command -v mono > /dev/null; then
        echo "##vso[task.setvariable variable=monoFound;]true"
        echo "Mono is already installed."
      else
        echo "##vso[task.setvariable variable=monoFound;]false"
        echo "Mono is not installed, installing..."
      fi
    displayName: 'Check for Mono'

  - ${{ if ne( $(monoFound), 'true') }}:
    - task: CmdLine@2
      inputs:
        script: |
          sudo apt-get update
          sudo apt-get install -y dotnet-sdk-8.0
          sudo apt-get install -y aspnetcore-runtime-8.0
          sudo apt-get install -y dotnet-runtime-8.0

    - script: sudo apt-get install -y dirmngr gnupg apt-transport-https ca-certificates software-properties-common
      displayName: 'Install dependencies'

    - script: sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
      displayName: 'Import Mono GPG key'  

    - script: sudo apt-add-repository 'deb https://download.mono-project.com/repo/ubuntu stable-focal main'
      displayName: 'Add Mono repository'

    - script: |
          sudo apt-get update
          sudo apt-get install -y mono-complete
      displayName: 'Install Mono' 

  - task: NuGetToolInstaller@1
    name: 'NuGetToolInstaller'
    displayName: 'NuGet tool installer'