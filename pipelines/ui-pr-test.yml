---
trigger:
  branches:
    include:
      - 'main'

stages:
  - stage: 'build_And_Test'
    displayName: 'build And Test'
    jobs:
      - job: build_and_test
        condition: eq(variables['Build.Reason'], 'PullRequest')
        pool:
          # name: ${{ parameters.buildAgent }}
          vmImage: ubuntu-latest

        steps:  
          - task: Npm@1
            displayName: Install npm dependencies
            inputs:
              command: 'install'
              workingDir: 'ui-spa/'

          - task: Npm@1
            displayName: Build web app package
            inputs:
              command: 'custom'
              customCommand: 'run build'
              workingDir: 'ui-spa/'
              
          - task: Npm@1
            displayName: Run tests
            env:
              CI: 'true'
            inputs:
              command: 'custom'
              customCommand: test
              workingDir: 'ui-spa/'